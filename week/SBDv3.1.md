# 23_2_5周报

> 近期包括未来工作分为如下几个内容：
>
> 1. 针对已有的工作，通过结果分析它们潜在的问题，并明确SBD可优化的方向；
> 2. 针对如下两个意见修改模型，并分析训练结果：
>    1. 修改生成目标 $y$ 的随机顺序；
>    2. 将当前步的点云潜在特征与初始步的潜在特征一同作为Score-based模型的特征输入；
> 3. 通过指标分析训练结果；
> 4. 通过分析输入噪声点云，分析离群点可能由哪类点产生。
>
> 本周已完成工作：
>
> - 使用Score-Based denoising完成降噪，并对结果进行分析；
> - 修改生成目标 $y$ 的随机顺序，并进行了分析；
> - 对比前面两个结果的指标；

## Score-Based 的结果

由于时间问题，这次分析的主要目标是50000点数0.01噪声的结果。(详细截图见[problems.pdf](https://github.com/DyllanElliia/myNoteBooks/blob/main/week/problems.pdf))

Score-based处理比较好的部分：

- 低频曲面降噪效果优秀，与之相关模型的指标优秀；
- 对于几何模型，如球、八面体等，高频信息和低频信息均能优秀恢复；

不足：

- 无法很好处理包含例如细圆柱体、两个相邻平行平面等信息的模型，如椅子、fandisk等，并会产生明显形变、离群点、破损的问题；
- 当要降噪的目标点处于两个平面中间时，它极有可能会变成无法处理的离群点；
- 高频边缘信息几乎无法保存。

## SBD结果分析

### 从指标结果分析

在[指标对比](#指标对比)中，我使用的是256000迭代后的模型，对比的是Score-based 1000000迭代的模型的结果。使用256000的原因是因为，在训练中发现继续有准确率下降的趋势。

结果可知（[可视化图片](#结果可视化)），在10000点数测试集中，0.01噪声和0.02噪声的结果原不如Score-based；0.03的结果部分优于Score-based。50000点数测试集的结果相对可观，在0.01噪声和0.02噪声下的结果接近与Score-based，但仍然有一定距离；0.03的结果大多优于Score-based。

综上，SBD在高噪声下的降噪似乎有优势，低噪声下的降噪仍然需要继续改进。

可添加的其它对比项：

- 对比PointClearNet的结果；

### 离群点问题解决进度

春节前调了一个训练参数，发现离群点问题消失了很多，这是一个意外的进度。

优化了训练过程中生成目标 $y$ 的随机顺序，指标轻度变优，似乎有一定效果。

新发现一个可能的潜在因素：

- 对于diffusion的扩散和采样，使用的迁移方程为：
  $$
  x^{(t)}=\sqrt{\alpha_t}x^{(t-1)}+\sqrt{1-\alpha_t}z
  $$
  虽然这也是一种线性关系，但与传统的噪声逆问题描述的$y=Hx+z$有一定区别。

  这个线性关系的表现在我现在参考的点云Diffusion模型中，如下图所示：

  ![image-20230205144646104](./assets/image-20230205144646104.png)

  > 暂时没想到如何描述，但这应该不是传统噪声逆问题所描述的那种噪声模型。

  点云降噪的目标噪声点云的噪声程度很小（我训练中采样的参数Beta的值非常小，也是基于这个理由）强行解释可以说由于噪声较小，这个线性关系可以近似等价为Score-Based那篇描述的线性关系。

  由于是强行解释，这意味着这是个潜在风险。

计划是通过分析输入噪声点云中点的位置，确认降噪结果中的离群点的产生原因，由于春节原因，这周没有把这个工作完成。

目前发现的原因：

- 若两个曲面是相邻的，例如椅子中间靠近的那两个平面、细圆柱体等，会导致模型无法正确判断曲面信息，导致大量离群点；
- 高频且无法通过简单曲面模型描述的曲面，模型可能需要更多训练才能正确提取：
  - 高频指曲率变化较大的地方；
  - 高频的简单曲面模型，例如正方体的棱、圆柱体的棱。

### 结果可视化

可视化部分结果

#### SBD（Ours）

0.01

![SBD_0.01](./assets/SBD_0.01.png)

0.02

![SBD_0.02](./assets/SBD_0.02.png)

0.03![SBD_0.03](./assets/SBD_0.03.png)

#### Score-Based

0.01![SB_0.01](./assets/SB_0.01.png)

0.02![SB_0.02](./assets/SB_0.02.png)

0.03

![SB_0.03](./assets/SB_0.03.png)

## 可尝试的改进

1. 将当前步的点云潜在特征与初始步的潜在特征一同作为Score-based模型的特征输入；
2. 修改Loss，引入Displacement相关的Target内容：
   - $\mathcal L=\mathbb E[grad+0.01*Distance]$
3. 调参；

## 指标对比

副标题命名规则，训练集-点云点数-噪声类型-噪声程度。

训练参数（部分）：

| Parameter      | Value                                     |
| -------------- | ----------------------------------------- |
| KNN_num        | 64 and 128                                |
| Training set   | 10000_possion,30000_possion,50000_possion |
| diffusion_step | 30                                        |
| beta           | $[1e-5,5e-5]$                             |
| iterations     | 256000                                    |

对比的是Score-based提供的迭代1e6模型的结果。

该指标对比是希望找出使用了diffusion和自监督后，可能会有的优势。

下面选取的样本不经过挑选，是测试输出的前10个结果。

标准使用p2f。

### PUNet-10000-possion-0.01

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000059   | 0.000155 |
| duck        |  0.000079   | 0.000164 |
| elk         |  0.000098   | 0.000262 |
| elephant    |  0.000063   | 0.000273 |
| quadric     |  0.000085   | 0.000259 |
| cow         |  0.000073   | 0.000231 |
| fandisk     |  0.000053   | 0.000161 |
| Icosahedron |  0.000052   | 0.000146 |
| star        |  0.000055   | 0.000135 |
| kitten      |  0.000058   | 0.000170 |



### PUNet-10000-possion-0.02

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000105   | 0.000176 |
| duck        |  0.000128   | 0.000186 |
| elk         |  0.000171   | 0.000319 |
| elephant    |  0.000154   | 0.000307 |
| quadric     |  0.000169   | 0.000311 |
| cow         |  0.000140   | 0.000272 |
| fandisk     |  0.000117   | 0.000194 |
| Icosahedron |  0.000093   | 0.000155 |
| star        |  0.000090   | 0.000141 |
| kitten      |  0.000118   | 0.000199 |



### PUNet-10000-possion-0.03

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000254   | 0.000213 |
| duck        |  0.000255   | 0.000217 |
| elk         |  0.000385   | 0.000397 |
| elephant    |  0.000351   | 0.000373 |
| quadric     |  0.000377   | 0.000391 |
| cow         |  0.000279   | 0.000332 |
| fandisk     |  0.000296   | 0.000256 |
| Icosahedron |  0.000192   | 0.000183 |
| star        |  0.000193   | 0.000159 |
| kitten      |  0.000284   | 0.000262 |



### PUNet-50000-possion-0.01

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000030   | 0.000069 |
| duck        |  0.000056   | 0.000087 |
| elk         |  0.000050   | 0.000120 |
| elephant    |  0.000028   | 0.000141 |
| quadric     |  0.000039   | 0.000104 |
| cow         |  0.000038   | 0.000099 |
| fandisk     |  0.000027   | 0.000067 |
| Icosahedron |  0.000023   | 0.000046 |
| star        |  0.000038   | 0.000054 |
| kitten      |  0.000026   | 0.000065 |



### PUNet-50000-possion-0.02

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000067   | 0.000085 |
| duck        |  0.000087   | 0.000099 |
| elk         |  0.000090   | 0.000145 |
| elephant    |  0.000086   | 0.000168 |
| quadric     |  0.000094   | 0.000145 |
| cow         |  0.000086   | 0.000130 |
| fandisk     |  0.000073   | 0.000086 |
| Icosahedron |  0.000049   | 0.000052 |
| star        |  0.000062   | 0.000056 |
| kitten      |  0.000058   | 0.000083 |



### PUNet-50000-possion-0.03

| Name        | Score-Based |   Ours   |
| ----------- | :---------: | :------: |
| moai        |  0.000230   | 0.000103 |
| duck        |  0.000238   | 0.000115 |
| elk         |  0.000256   | 0.000162 |
| elephant    |  0.000257   | 0.000193 |
| quadric     |  0.000261   | 0.000176 |
| cow         |  0.000244   | 0.000155 |
| fandisk     |  0.000260   | 0.000114 |
| Icosahedron |  0.000195   | 0.000063 |
| star        |  0.000207   | 0.000064 |
| kitten      |  0.000204   | 0.000101 |

